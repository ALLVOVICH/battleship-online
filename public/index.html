<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Морской бой онлайн</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont;
  background:#f5f5f7;
}
.app {
  max-width:1000px;
  margin:40px auto;
  background:white;
  border-radius:24px;
  padding:30px;
  box-shadow:0 20px 50px rgba(0,0,0,.15);
}
.game {
  display:flex;
  gap:40px;
}
.board {
  display:grid;
  grid-template-columns:repeat(10,40px);
  gap:6px;
}
.cell {
  width:40px;
  height:40px;
  border-radius:10px;
  background:#e5e7eb;
  cursor:pointer;
}
.cell.ship { background:#0ea5e9; }
.cell.hit { background:#ef4444; }
.cell.miss { background:#94a3b8; }
.info {
  font-size:14px;
}
</style>
</head>

<body>
<div class="app">
  <h1>⚓ Морской бой (онлайн)</h1>
  <p id="status">Ожидание второго игрока…</p>

  <div class="game">
    <div>
      <h3>Твое поле</h3>
      <div class="board" id="my"></div>
    </div>
    <div>
      <h3>Поле соперника</h3>
      <div class="board" id="enemy"></div>
    </div>
    <div class="info">
      <b>Игрок:</b> <span id="player">—</span><br>
      <b>Ход:</b> <span id="turn">—</span>
    </div>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let player = 0;
let myTurn = false;

const myBoard = Array.from({length:10},()=>Array(10).fill(0));
const enemyBoard = Array.from({length:10},()=>Array(10).fill(0));

const myEl = document.getElementById("my");
const enemyEl = document.getElementById("enemy");

function draw(board, el, clickable=false){
  el.innerHTML="";
  for(let y=0;y<10;y++){
    for(let x=0;x<10;x++){
      const c=document.createElement("div");
      c.className="cell";
      if(board[y][x]===1) c.classList.add("ship");
      if(board[y][x]===2) c.classList.add("hit");
      if(board[y][x]===3) c.classList.add("miss");
      if(clickable) c.onclick=()=>shoot(x,y);
      el.appendChild(c);
    }
  }
}

function shoot(x,y){
  if(!myTurn) return;
  socket.emit("move",{x,y});
  myTurn=false;
  updateTurn();
}

socket.on("player", n=>{
  player=n;
  document.getElementById("player").textContent=n;
  document.getElementById("status").textContent="Игра началась";
  myTurn = n===1;
  updateTurn();
});

socket.on("move", ({x,y})=>{
  enemyBoard[y][x]=2;
  draw(enemyBoard, enemyEl, myTurn);
  myTurn=true;
  updateTurn();
});

function updateTurn(){
  document.getElementById("turn").textContent =
    myTurn ? "Ваш" : "Соперника";
}

draw(myBoard,myEl);
draw(enemyBoard,enemyEl,true);
</script>
</body>
</html>
